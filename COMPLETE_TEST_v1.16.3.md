# WDS Manager v1.16.3 - å®Œæ•´å‰å¾Œç«¯æ¸¬è©¦è¨ˆåŠƒ

## ç‰ˆæœ¬ä¿¡æ¯
- **ç•¶å‰ç‰ˆæœ¬**: v1.16.3
- **æ¸¬è©¦æ—¥æœŸ**: 2025-10-27
- **æ¸¬è©¦ç›®çš„**: é©—è­‰è‡ªå®šç¾© bucket é¸æ“‡åŠŸèƒ½å®Œæ•´æ€§ï¼ˆå‰ç«¯+å¾Œç«¯ï¼‰

---

## å•é¡Œå›é¡§

### v1.16.2 å•é¡Œ
- âœ… å¾Œç«¯ä»£ç¢¼å·²ä¿®å¾©ï¼ˆs3Service, deployService æ¥å— req åƒæ•¸ï¼‰
- âŒ **å‰ç«¯æœªç™¼é€è‡ªå®šç¾© bucket headers**
- çµæœï¼šéƒ¨ç½²æ™‚ä»ä½¿ç”¨é»˜èª bucketï¼Œå‡ºç¾ NoSuchKey éŒ¯èª¤

### v1.16.3 ä¿®å¾©
- âœ… å‰ç«¯æ‰€æœ‰éƒ¨ç½²ç›¸é—œ API è«‹æ±‚æ·»åŠ è‡ªå®šç¾© bucket headers
- âœ… å®Œæ•´çš„ç«¯åˆ°ç«¯è‡ªå®šç¾© bucket é¸æ“‡åŠŸèƒ½

---

## æ¸¬è©¦è¨ˆåŠƒ

### éšæ®µ 1: å¾Œç«¯ API æ¸¬è©¦ (ç„¡éœ€èªè­‰)

#### Test 1.1: Health Check âœ…
```bash
curl -s http://localhost:3015/api/health | python3 -m json.tool
```
**é æœŸçµæœ**:
```json
{
    "status": "ok",
    "timestamp": "...",
    "version": "1.16.3"
}
```
**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

#### Test 1.2: Version API âœ…
```bash
curl -s http://localhost:3015/api/version | python3 -m json.tool | head -20
```
**é æœŸçµæœ**: é¡¯ç¤º v1.16.3 ç‰ˆæœ¬ä¿¡æ¯å’Œè®Šæ›´è¨˜éŒ„
**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

### éšæ®µ 2: å‰ç«¯ç•Œé¢æ¸¬è©¦ (éœ€è¦ç™»å…¥)

#### Test 2.1: ç™»å…¥åŠŸèƒ½ â³
**æ­¥é©Ÿ**:
1. æ‰“é–‹ http://localhost:3015
2. é»æ“Š Google ç™»å…¥
3. ä½¿ç”¨ lonely.h@jvd.tw ç™»å…¥

**é æœŸçµæœ**: æˆåŠŸç™»å…¥ï¼Œé¡¯ç¤ºç”¨æˆ¶ä¿¡æ¯
**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

#### Test 2.2: Bucket ç‹€æ…‹æª¢æŸ¥ â³
**æ­¥é©Ÿ**:
1. ç™»å…¥å¾ŒæŸ¥çœ‹ä¸»é 
2. æª¢æŸ¥ "Build Artifacts Bucket" å¡ç‰‡
3. æª¢æŸ¥ "Deploy WebUI Bucket" å¡ç‰‡

**é æœŸçµæœ**:
- Build: jenkins-build-artfs (accessible âœ“)
- Deploy: deploy-webui-bucket (accessible âœ“)

**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

#### Test 2.3: åˆ—å‡ºæ‰€æœ‰ S3 Buckets â³
**æ­¥é©Ÿ**:
1. é»æ“Š "Build Artifacts Bucket" å¡ç‰‡ä¸Šçš„ç·¨è¼¯æŒ‰éˆ• (é‰›ç­†åœ–æ¨™)
2. è§€å¯Ÿ bucket é¸æ“‡å™¨å½ˆçª—

**é æœŸçµæœ**:
- ä¸‹æ‹‰é¸å–®é¡¯ç¤ºæ‰€æœ‰ S3 buckets
- Buckets æŒ‰å­—æ¯é †åºæ’åˆ—
- é»˜èª bucket æ¨™è¨˜ç‚º "(default)"
- å¯ä»¥ä½¿ç”¨ filter è¼¸å…¥æ¡†æœç´¢

**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

#### Test 2.4: åˆ‡æ›åˆ° release-webui Bucket â³
**æ­¥é©Ÿ**:
1. åœ¨ bucket é¸æ“‡å™¨ä¸­é¸æ“‡ "release-webui"
2. é»æ“Š "Change Bucket"
3. é é¢è‡ªå‹•é‡æ–°è¼‰å…¥

**é æœŸçµæœ**:
- Bucket ç‹€æ…‹å¡ç‰‡æ›´æ–°ç‚º "release-webui"
- sessionStorage ä¿å­˜ customBuildBucket = "release-webui"

**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

**é©—è­‰å‘½ä»¤** (åœ¨ç€è¦½å™¨ console):
```javascript
sessionStorage.getItem('customBuildBucket')
// æ‡‰è©²è¿”å›: "release-webui"
```

---

#### Test 2.5: ç€è¦½ release-webui Bucket ä¸­çš„ Artifacts â³
**æ­¥é©Ÿ**:
1. ç¢ºèªå·²åˆ‡æ›åˆ° release-webui bucket
2. é»æ“Š "Browse Build Artifacts"
3. æŸ¥çœ‹é¡¯ç¤ºçš„ artifacts

**é æœŸçµæœ**:
- é¡¯ç¤º release-webui bucket ä¸­çš„æ–‡ä»¶
- æ‡‰è©²çœ‹åˆ° i18n-prd-1.0.26.zip
- æ‡‰è©²çœ‹åˆ° bundle-i18n-prd-1.0.18.zip
- æ‡‰è©²çœ‹åˆ°å„ç¨®éŠæˆ² ZIP æ–‡ä»¶

**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

**å¾Œç«¯æ—¥èªŒé©—è­‰**:
```bash
tail -f logs/combined.log | grep "custom build bucket"
```
æ‡‰è©²çœ‹åˆ°: `"Using custom build bucket: release-webui"`

---

### éšæ®µ 3: éƒ¨ç½²åŠŸèƒ½æ¸¬è©¦ (é—œéµæ¸¬è©¦)

#### Test 3.1: é¸æ“‡ Artifact é€²è¡Œéƒ¨ç½² â³
**æ­¥é©Ÿ**:
1. ç¢ºèªä»åœ¨ release-webui bucket
2. é¸æ“‡ "i18n-prd-1.0.26.zip"
3. é»æ“Š "Deploy Selected"

**é æœŸçµæœ**: å‡ºç¾éƒ¨ç½²ç¢ºèªå°è©±æ¡†

**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

#### Test 3.2: åŸ·è¡Œéƒ¨ç½²ä¸¦ç›£æ§æ—¥èªŒ ğŸ”´ **é—œéµæ¸¬è©¦**
**æ­¥é©Ÿ**:
1. ç¢ºèªéƒ¨ç½²
2. åŒæ™‚ç›£æ§å¾Œç«¯æ—¥èªŒ

**ç›£æ§å‘½ä»¤** (åœ¨å¦ä¸€å€‹çµ‚ç«¯):
```bash
tail -f /Users/lonelyhsu/gemini/claude-project/wds-manager/logs/combined.log | grep -E "custom build bucket|Processing artifact|NoSuchKey|Deployment"
```

**é æœŸçµæœ**:
```
âœ… æ‡‰è©²çœ‹åˆ°: "Using custom build bucket: release-webui"
âœ… æ‡‰è©²çœ‹åˆ°: "Processing artifact: i18n-prd-1.0.26.zip"
âœ… æ‡‰è©²çœ‹åˆ°: "Deployment completed: success" æˆ– "partial_success"
âœ… æ‡‰è©²çœ‹åˆ°æª”æ¡ˆä¸Šå‚³æ—¥èªŒ
âŒ ä¸æ‡‰è©²çœ‹åˆ°: NoSuchKey éŒ¯èª¤
```

**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

#### Test 3.3: é©—è­‰è‡ªå®šç¾© Bucket Headers ç™¼é€ ğŸ”´ **é—œéµé©—è­‰**
**æ­¥é©Ÿ**:
1. åœ¨éƒ¨ç½²éç¨‹ä¸­æŸ¥çœ‹ç¶²è·¯è«‹æ±‚ (ç€è¦½å™¨ DevTools > Network)
2. æ‰¾åˆ° `/api/deploy` POST è«‹æ±‚
3. æª¢æŸ¥ Request Headers

**é æœŸ Request Headers**:
```
Content-Type: application/json
X-Custom-Build-Bucket: release-webui
```

**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

#### Test 3.4: é©—è­‰éƒ¨ç½²æˆåŠŸ â³
**æ­¥é©Ÿ**:
1. ç­‰å¾…éƒ¨ç½²å®Œæˆ
2. æª¢æŸ¥éƒ¨ç½²ç‹€æ…‹æ¶ˆæ¯
3. æŸ¥çœ‹ "Recent Activity"

**é æœŸçµæœ**:
- éƒ¨ç½²ç‹€æ…‹é¡¯ç¤ºæˆåŠŸ
- Recent Activity é¡¯ç¤ºæ–°çš„éƒ¨ç½²è¨˜éŒ„
- è¨˜éŒ„åŒ…å«ç”¨æˆ¶ä¿¡æ¯ (lonely.h@jvd.tw)
- è¨˜éŒ„é¡¯ç¤ºéƒ¨ç½²çš„æ–‡ä»¶æ•¸é‡

**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

#### Test 3.5: åˆ‡æ›å›é»˜èª Bucket ä¸¦æ¸¬è©¦ â³
**æ­¥é©Ÿ**:
1. é»æ“Š "Use default" æŒ‰éˆ•åˆ‡æ›å› jenkins-build-artfs
2. ç€è¦½ artifacts
3. å˜—è©¦éƒ¨ç½²ä¸€å€‹æ–‡ä»¶

**é æœŸçµæœ**:
- æˆåŠŸåˆ‡æ›å›é»˜èª bucket
- å¯ä»¥çœ‹åˆ° jenkins-build-artfs ä¸­çš„æ–‡ä»¶
- éƒ¨ç½²ä½¿ç”¨é»˜èª bucket
- æ—¥èªŒä¸é¡¯ç¤º "custom build bucket"

**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

### éšæ®µ 4: å…¶ä»–åŠŸèƒ½æ¸¬è©¦

#### Test 4.1: Version Check API â³
**æ­¥é©Ÿ**:
1. é¸æ“‡å¤šå€‹ artifacts
2. é»æ“Š "Deploy Selected"
3. è§€å¯Ÿ version check è­¦å‘Šï¼ˆå¦‚æœæœ‰ï¼‰

**é©—è­‰å¾Œç«¯æ—¥èªŒ**:
```bash
tail -f logs/combined.log | grep "check-versions"
```

**é æœŸçµæœ**:
- /api/check-versions è«‹æ±‚åŒ…å«è‡ªå®šç¾© bucket headers
- å¦‚æœæœ‰èˆŠç‰ˆæœ¬ï¼Œé¡¯ç¤ºè­¦å‘Š

**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

#### Test 4.2: Delete Artifacts â³
**æ­¥é©Ÿ**:
1. åˆ‡æ›åˆ°æ¸¬è©¦ bucket (å¦‚æœæœ‰)
2. é¸æ“‡ä¸€å€‹æ¸¬è©¦æ–‡ä»¶
3. é»æ“Š "Delete Selected"
4. ç¢ºèªåˆªé™¤

**é æœŸçµæœ**:
- åˆªé™¤è«‹æ±‚åŒ…å«è‡ªå®šç¾© bucket headers
- å¾æ­£ç¢ºçš„ bucket åˆªé™¤æ–‡ä»¶

**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

#### Test 4.3: Clear Deploy Bucket â³
**æ­¥é©Ÿ**:
1. é»æ“Š "Clear Deploy Bucket"
2. ç¢ºèªæ“ä½œ

**é æœŸçµæœ**:
- è«‹æ±‚åŒ…å«è‡ªå®šç¾© bucket headers
- æ¸…é™¤æŒ‡å®šçš„ deploy bucket

**å¯¦éš›çµæœ**: å¾…æ¸¬è©¦

---

## æˆåŠŸæ¨™æº–

### å¿…é ˆé€šéçš„æ¸¬è©¦
1. âœ… Health check é¡¯ç¤º v1.16.3
2. âœ… å¯ä»¥åˆ—å‡ºæ‰€æœ‰ S3 buckets
3. âœ… å¯ä»¥åˆ‡æ›åˆ° release-webui bucket
4. âœ… ç€è¦½ release-webui é¡¯ç¤ºæ­£ç¢ºçš„æ–‡ä»¶
5. ğŸ”´ **éƒ¨ç½²æ™‚ç™¼é€ X-Custom-Build-Bucket header**
6. ğŸ”´ **éƒ¨ç½²æ™‚å¾Œç«¯ä½¿ç”¨ release-webui bucket**
7. ğŸ”´ **éƒ¨ç½²æˆåŠŸï¼Œç„¡ NoSuchKey éŒ¯èª¤**
8. âœ… å¯ä»¥åˆ‡æ›å›é»˜èª bucket
9. âœ… æ‰€æœ‰éƒ¨ç½²ç›¸é—œ API éƒ½ç™¼é€è‡ªå®šç¾© headers

### é æœŸä¿®å¾©é©—è­‰
**v1.16.3 æ‡‰è©²è§£æ±ºçš„å•é¡Œ**:
- âŒ v1.16.2: å‰ç«¯ä¸ç™¼é€ headers â†’ **v1.16.3: å‰ç«¯ç™¼é€ headers** âœ…
- âŒ v1.16.2: éƒ¨ç½²ä½¿ç”¨é»˜èª bucket â†’ **v1.16.3: éƒ¨ç½²ä½¿ç”¨è‡ªå®šç¾© bucket** âœ…

---

## æ¸¬è©¦è¨˜éŒ„

### Test 1.1: Health Check
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **ç‰ˆæœ¬**: _______________
- **å‚™è¨»**: _______________

### Test 1.2: Version API
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **å‚™è¨»**: _______________

### Test 2.1: ç™»å…¥åŠŸèƒ½
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **ç”¨æˆ¶**: _______________
- **å‚™è¨»**: _______________

### Test 2.2: Bucket ç‹€æ…‹æª¢æŸ¥
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **Build Bucket**: _______________
- **Deploy Bucket**: _______________
- **å‚™è¨»**: _______________

### Test 2.3: åˆ—å‡ºæ‰€æœ‰ S3 Buckets
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **Bucket æ•¸é‡**: _______________
- **å‚™è¨»**: _______________

### Test 2.4: åˆ‡æ›åˆ° release-webui
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **sessionStorage**: _______________
- **å‚™è¨»**: _______________

### Test 2.5: ç€è¦½ release-webui Artifacts
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **å¾Œç«¯æ—¥èªŒ**: _______________
- **å‚™è¨»**: _______________

### Test 3.1: é¸æ“‡ Artifact
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **Artifact**: _______________
- **å‚™è¨»**: _______________

### Test 3.2: åŸ·è¡Œéƒ¨ç½² ğŸ”´ **é—œéµ**
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **å¾Œç«¯æ—¥èªŒ - Custom Bucket**: _______________
- **å¾Œç«¯æ—¥èªŒ - Processing**: _______________
- **å¾Œç«¯æ—¥èªŒ - Status**: _______________
- **NoSuchKey éŒ¯èª¤**: YES / NO
- **å‚™è¨»**: _______________

### Test 3.3: é©—è­‰ Headers ğŸ”´ **é—œéµ**
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **X-Custom-Build-Bucket**: _______________
- **å‚™è¨»**: _______________

### Test 3.4: é©—è­‰éƒ¨ç½²æˆåŠŸ
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **éƒ¨ç½²ç‹€æ…‹**: _______________
- **æ–‡ä»¶æ•¸é‡**: _______________
- **å‚™è¨»**: _______________

### Test 3.5: åˆ‡æ›å›é»˜èª Bucket
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **å‚™è¨»**: _______________

### Test 4.1: Version Check API
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **å‚™è¨»**: _______________

### Test 4.2: Delete Artifacts
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **å‚™è¨»**: _______________

### Test 4.3: Clear Deploy Bucket
- **åŸ·è¡Œæ™‚é–“**: _______________
- **çµæœ**: PASS / FAIL
- **å‚™è¨»**: _______________

---

## æœ€çµ‚çµè«–

**ç¸½æ¸¬è©¦æ•¸**: _____ / _____
**é€šéç‡**: _____%

**é—œéµåŠŸèƒ½ç‹€æ…‹**:
- [ ] è‡ªå®šç¾© bucket ç€è¦½
- [ ] è‡ªå®šç¾© bucket éƒ¨ç½²
- [ ] Headers æ­£ç¢ºç™¼é€
- [ ] ç«¯åˆ°ç«¯åŠŸèƒ½å®Œæ•´

**å»ºè­°**: _______________

**æ¸¬è©¦äººå“¡**: _______________
**æ¸¬è©¦æ—¥æœŸ**: _______________
**ç°½å**: _______________
